!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("events")):"function"==typeof define&&define.amd?define(["exports","react","events"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GraphQLHooks={},e.React,e.EventEmitter)}(this,(function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(t),i=n(r);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return e.length>n?{done:!1,value:e[n++]}:{done:!0}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h=o.default.createContext();h.displayName="ClientContext";var p=function(e){return"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob||e instanceof class{constructor({uri:e,name:t,type:r}){this.uri=e,this.name=t,this.type=r}}},d=function(e){return p(e)||null!==e&&"object"==typeof e&&"function"==typeof e.pipe||null!==e&&"object"==typeof e&&"function"==typeof e.stream},y=function(){function e(e){var t=this;0===e.length&&e.push((function(e,t){return t()}));for(var r,n=function(){var e,n=r.value;if("function"!=typeof n)throw Error("GraphQLClient Middleware: middleware has to be of type `function`");t.run=(e=t.run,function(r,o){e(r,(function(){n.call(t,r,o.bind.call(o,null,r))}))})},o=l(e);!(r=o()).done;)n()}return e.prototype.run=function(e,t){t.apply(this,e)},e}(),v=function(){function e(e){void 0===e&&(e={}),this.fullWsTransport=e.fullWsTransport,this.subscriptionClient=e.subscriptionClient,"function"==typeof this.subscriptionClient&&(this.subscriptionClient=this.subscriptionClient()),this.verifyConfig(e),this.cache=e.cache,this.headers=e.headers||{},this.ssrMode=e.ssrMode,this.ssrPromises=[],this.url=e.url,this.fetch=e.fetch||"undefined"!=typeof fetch&&fetch&&fetch.bind(),this.fetchOptions=e.fetchOptions||{},this.FormData=e.FormData||("undefined"!=typeof FormData?FormData:void 0),this.logErrors=void 0===e.logErrors||e.logErrors,this.onError=e.onError,this.useGETForQueries=!0===e.useGETForQueries,this.middleware=new y(e.middleware||[]),this.mutationsEmitter=new i.default}var t=e.prototype;return t.verifyConfig=function(e){if(!e.url){if(!this.fullWsTransport)throw Error("GraphQLClient: config.url is required");if(!this.subscriptionClient)throw Error("GraphQLClient: subscriptionClient is required")}if(e.fetch&&"function"!=typeof e.fetch)throw Error("GraphQLClient: config.fetch must be a function");if(("undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement||e.ssrMode)&&!e.fetch&&"function"!=typeof fetch)throw Error("GraphQLClient: fetch must be polyfilled or passed in new GraphQLClient({ fetch })");if(e.ssrMode&&!e.cache)throw Error("GraphQLClient: config.cache is required when in ssrMode")},t.setHeader=function(e,t){return this.headers[e]=t,this},t.setHeaders=function(e){return this.headers=e,this},t.removeHeader=function(e){return delete this.headers[e],this},t.logErrorResult=function(e){var t=e.result,r=e.operation;console.error("GraphQL Hooks Error"),console.groupCollapsed("---\x3e Full Error Details"),console.groupCollapsed("Operation:"),console.log(r),console.groupEnd();var n=t.error;n&&(n.fetchError&&(console.groupCollapsed("FETCH ERROR:"),console.log(n.fetchError),console.groupEnd()),n.httpError&&(console.groupCollapsed("HTTP ERROR:"),console.log(n.httpError),console.groupEnd()),n.graphQLErrors&&n.graphQLErrors.length>0&&(console.groupCollapsed("GRAPHQL ERROR:"),n.graphQLErrors.forEach((function(e){return console.log(e)})),console.groupEnd())),console.groupEnd()},t.generateResult=function(e){var t=e.fetchError,r=e.httpError,n=e.graphQLErrors,o=e.data;return!!(n&&n.length>0||t||r)?{data:o,error:{fetchError:t,httpError:r,graphQLErrors:n}}:{data:o}},t.getCacheKey=function(e,t){return void 0===t&&(t={}),{operation:e,fetchOptions:s(s({},this.fetchOptions),t.fetchOptionsOverrides)}},t.getCache=function(e){var t=this.cache?this.cache.get(e):null;if(t)return t},t.saveCache=function(e,t){this.cache&&this.cache.set(e,t)},t.getFetchOptions=function(e,t){void 0===t&&(t={});var r=s(s({method:"POST",headers:s({},this.headers)},this.fetchOptions),t);if("GET"===r.method)return r;var n=function(e,t="",r=p){const n=new Map,o=new Map;return{clone:function e(t,i,a){let s=t;if(r(t)){s=null;const e=n.get(t);e?e.push(i):n.set(t,[i])}else{const r=Array.isArray(t)||"undefined"!=typeof FileList&&t instanceof FileList,n=t&&t.constructor===Object;if(r||n){const n=o.has(t);if(n?s=o.get(t):(s=r?[]:{},o.set(t,s)),!a.has(t)){const o=i?i+".":"",u=new Set(a).add(t);if(r){let r=0;for(const i of t){const t=e(i,o+r++,u);n||s.push(t)}}else for(const r in t){const i=e(t[r],o+r,u);n||(s[r]=i)}}}}return s}(e,t,new Set),files:n}}(e,"",d),o=n.files,i=JSON.stringify(n.clone);if(o.size){if(!this.FormData)throw Error("GraphQLClient: FormData must be polyfilled or passed in new GraphQLClient({ FormData })");var a=new this.FormData;a.append("operations",i);var u={},c=0;o.forEach((function(e){u[++c]=e})),a.append("map",JSON.stringify(u)),c=0,o.forEach((function(e,t){a.append(""+ ++c,t,t.name)})),r.body=a}else r.headers["Content-Type"]="application/json",r.body=i;return r},t.request=function(e,t){var r=this;void 0===t&&(t={});var n=[],o=function(e){return n.push(e)};return new Promise((function(i,a){return r.middleware.run({operation:e,client:r,addResponseHook:o,resolve:i,reject:a},(function(e){var o=e.operation,s=function(e){return n.length>0?(t=n,function(e){return t.reduce((function(e,t){return e.then(t)}),Promise.resolve(e))})(e):e;var t};return r.fullWsTransport?r.requestViaWS(o).then(s).then(i).catch(a):r.url?r.requestViaHttp(o,t).then(s).then(i).catch(a):void a(Error("GraphQLClient: config.url is required"))}))}))},t.requestViaHttp=function(e,t){var r=this,n=this.url,o=this.getFetchOptions(e,t.fetchOptionsOverrides);"GET"===o.method&&(n=n+"?"+Object.entries(e).filter((function(e){return t.hashOnly?"variables"===e[0]:!!e[1]})).map((function(e){var t=e[0],r=e[1];return"variables"===t&&(r=JSON.stringify(r)),t+"="+encodeURIComponent(r)})).join("&"),e.hash&&(n+="&extensions="+encodeURIComponent(JSON.stringify({persistedQuery:{version:1,sha256Hash:e.hash}}))));return this.fetch(n,o).then((function(e){return e.ok?e.json().then((function(n){var o=n.data;return r.generateResult({graphQLErrors:n.errors,data:"function"==typeof t.responseReducer&&t.responseReducer(o,e)||o})})):e.text().then((function(t){return r.generateResult({httpError:{status:e.status,statusText:e.statusText,body:t}})}))})).catch((function(e){return r.generateResult({fetchError:e})})).then((function(t){return t.error&&(r.logErrors&&r.logErrorResult({result:t,operation:e}),r.onError&&r.onError({result:t,operation:e})),t}))},t.requestViaWS=function(e){var t=this;return new Promise((function(r,n){var o;try{var i=t.createSubscription(e).subscribe({next:function(e){o=e},error:n,complete:function(){i.unsubscribe(),r(o)}})}catch(e){n(e)}}))},t.createSubscription=function(e){var t=this;if(!this.subscriptionClient)throw Error("No SubscriptionClient! Please set in the constructor.");return"function"==typeof this.subscriptionClient.subscribe?{subscribe:function(r){return{unsubscribe:t.subscriptionClient.subscribe(e,r)}}}:this.subscriptionClient.request(e)},e}(),b=function(e){this.fetchError=e.fetchError,this.httpError=e.httpError,this.graphQLErrors=e.graphQLErrors},g=function(e){var t,r;function n(t){var r;if(void 0===t&&(t={}),(r=e.call(this,t)||this).localQueries=t.localQueries,r.requestDelayMs=t.requestDelayMs||0,!r.localQueries)throw Error("LocalGraphQLClient: `localQueries` object required in the constructor options");return r}(t=n).prototype=Object.create((r=e).prototype),t.prototype.constructor=t,c(t,r);var o=n.prototype;return o.verifyConfig=function(){},o.request=function(e){var t,r=this;if(!this.localQueries[e.query])throw Error("LocalGraphQLClient: no query match for: "+e.query);return(t=this.requestDelayMs,new Promise((function(e){setTimeout(e,t)}))).then((function(){return Promise.resolve(r.localQueries[e.query](e.variables,e.operationName))})).then((function(e){return e instanceof b?{error:e}:{data:e}}))},n}(v);var E=Object.prototype.hasOwnProperty;function m(e,t,r){for(r of e.keys())if(C(r,t))return r}function C(e,t){var r,n,o;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return""+e==""+t;if(r===Array){if((n=e.length)===t.length)for(;n--&&C(e[n],t[n]););return-1===n}if(r===Set){if(e.size!==t.size)return!1;for(n of e){if((o=n)&&"object"==typeof o&&!(o=m(t,o)))return!1;if(!t.has(o))return!1}return!0}if(r===Map){if(e.size!==t.size)return!1;for(n of e){if((o=n[0])&&"object"==typeof o&&!(o=m(t,o)))return!1;if(!C(n[1],t.get(o)))return!1}return!0}if(r===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(r===DataView){if((n=e.byteLength)===t.byteLength)for(;n--&&e.getInt8(n)===t.getInt8(n););return-1===n}if(ArrayBuffer.isView(e)){if((n=e.byteLength)===t.byteLength)for(;n--&&e[n]===t[n];);return-1===n}if(!r||"object"==typeof e){for(r in n=0,e){if(E.call(e,r)&&++n&&!E.call(t,r))return!1;if(!(r in t)||!C(e[r],t[r]))return!1}return Object.keys(t).length===n}}return e!=e&&t!=t}var O="RESET_STATE",w="LOADING",L="CACHE_HIT",Q="REQUEST_RESULT";function S(e,t){switch(t.type){case O:return t.initialState;case w:return e.error?s(s({},t.initialState),{},{data:e.data,loading:!0}):e.loading?e:s(s({},e),{},{loading:!0});case L:return e.cacheHit&&!t.resetState?e:s(s({},t.result),{},{cacheHit:!0,loading:!1});case Q:return s(s({},t.result),{},{data:e.data&&t.result.data&&t.updateData?t.updateData(e.data,t.result.data):t.result.data,cacheHit:!1,loading:!1});default:return e}}function j(e,t){if(void 0===t&&(t={}),"string"!=typeof e)throw Error("Your query must be a string. If you are using the `gql` template literal from graphql-tag, remove it from your query.");var r=o.default.useContext(h),n=t.client||r,i=o.default.useRef(!0),a=o.default.useRef(null),u={query:e,variables:t.variables,operationName:t.operationName,persisted:t.persisted};(t.persisted||n.useGETForQueries&&!t.isMutation)&&(t.fetchOptionsOverrides=s(s({},t.fetchOptionsOverrides),{},{method:"GET"}));var c=n.getCacheKey(u,t),f=t.isMutation||t.isManual,l=t.skipCache||!n.cache?null:n.cache.get(c),p=s(s({},l),{},{cacheHit:!!l,loading:!f&&!l}),d=o.default.useReducer(S,p),y=d[0],v=d[1],b=JSON.stringify(c);o.default.useEffect((function(){t.updateData||v({type:O,initialState:p})}),[b]),o.default.useEffect((function(){return i.current=!0,function(){i.current=!1}}),[]);var g,E,m,j=(g=function(r){var o=s(s({},t),r),c=s(s({},u),{},{variables:o.variables,operationName:o.operationName});if(!i.current)return Promise.resolve({error:{fetchError:Error("fetchData should not be called after hook unmounted")},loading:!1,cacheHit:!1});var f=n.getCacheKey(c,o);a.current=f;var l=o.skipCache?null:n.getCache(f);return l?(v({type:L,result:l,resetState:b!==JSON.stringify(y.cacheKey)}),Promise.resolve(l)):(v({type:w,initialState:p}),n.request(c,o).then((function(r){if(o.updateData&&"function"!=typeof o.updateData)throw Error("options.updateData must be a function");var u=s({},r);if(o.useCache&&(u.useCache=!0,u.cacheKey=f,n.ssrMode)){var l={error:u.error,data:o.updateData?o.updateData(y.data,u.data):u.data};n.saveCache(f,l)}return i.current&&f===a.current&&v({type:Q,updateData:o.updateData,result:u}),t.isMutation&&n.mutationsEmitter.emit(e,s(s({},c),{},{mutation:e,result:u})),r})))},E=[n,t,u],m=o.default.useRef(),C(E,m.current)||(m.current=E),o.default.useCallback(g,m.current));o.default.useEffect((function(){y.useCache&&!n.ssrMode&&n.saveCache(y.cacheKey,y)}),[n,y]);return[j,y,function(e){return void 0===e&&(e={}),v({type:O,initialState:s(s({},p),e)})}]}var R={useCache:!0,skip:!1,throwErrors:!1};e.ClientContext=h,e.GraphQLClient=v,e.LocalGraphQLClient=g,e.LocalGraphQLError=b,e.useClientRequest=j,e.useManualQuery=function(e,t){return j(e,s({useCache:!0,isManual:!0},t))},e.useMutation=function(e,t){return j(e,s({isMutation:!0},t))},e.useQuery=function(e,t){void 0===t&&(t={});var r=s(s({},R),t),n=o.default.useContext(h),i=t.client||n,a=o.default.useState(!1),u=a[0],c=a[1],f=j(e,r),l=f[0],p=f[1];if(i.ssrMode&&!1!==t.ssr&&!u&&!t.skipCache&&!t.skip){if(!p.data&&!p.error){var d=l();i.ssrPromises.push(d)}c(!0)}var y=JSON.stringify(r);o.default.useEffect((function(){r.skip||l()}),[e,y]),o.default.useEffect((function(){if(p.error&&r.throwErrors)throw p.error}),[p.error,r.throwErrors]);var v=o.default.useCallback((function(e){return void 0===e&&(e={}),l(s({skipCache:!0,updateData:function(e,t){return t}},e))}),[l]);return o.default.useEffect((function(){var e,r,n=(r={},(Array.isArray(e=t.refetchAfterMutations)?e:[e]).forEach((function(e){if(null!=e){var t=typeof e;"string"===t?r[e]={}:"object"===t&&(r[e.mutation]={filter:e.filter})}})),r),o=Object.keys(n),a=function(e){var t=e.variables,r=n[e.mutation].filter;(!r||t&&r(t))&&v()};return o.forEach((function(e){i.mutationsEmitter.on(e,a)})),function(){o.forEach((function(e){i.mutationsEmitter.removeListener(e,a)}))}}),[t.refetchAfterMutations,v,i.mutationsEmitter]),s(s({},p),{},{refetch:v})},e.useSubscription=function(e,r){var n=t.useRef(r);n.current=r;var o=t.useContext(h),i=e.client||o,a={query:e.query,variables:e.variables};t.useEffect((function(){var e=i.createSubscription(a).subscribe({next:function(e){n.current(e)},error:function(e){n.current({errors:e})},complete:function(){e.unsubscribe()}});return function(){e.unsubscribe()}}),[])},Object.defineProperty(e,"__esModule",{value:!0})}));
