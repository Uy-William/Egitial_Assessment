{"ast":null,"code":"import React, { useRef, useContext, useEffect } from 'react';\nimport EventEmitter from 'events';\nimport { isExtractableFile, extractFiles } from 'extract-files';\nimport { dequal } from 'dequal';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar ClientContext = React.createContext();\nClientContext.displayName = 'ClientContext';\n\nvar canUseDOM = function () {\n  return typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined';\n};\n\nvar isExtractableFileEnhanced = function isExtractableFileEnhanced(value) {\n  return isExtractableFile(value) || // Check if stream\n  // https://github.com/sindresorhus/is-stream/blob/3750505b0727f6df54324784fe369365ef78841e/index.js#L3\n  value !== null && typeof value === 'object' && typeof value.pipe === 'function' || // Check if formdata-node File\n  // https://github.com/octet-stream/form-data/blob/14a6708f0ae28a5ffded8b6f8156394ba1d1244e/lib/File.ts#L29\n  value !== null && typeof value === 'object' && typeof value.stream === 'function';\n};\n/**\n * Generic Middleware function that\n * will run object through all provided functions\n *\n *\n * Minimal example:\n * const MyMiddleware = ({ operation }, next) => {\n *   operation.variables.user = 'admin'\n *   next()\n * }\n *\n * All parameters provided are written in run function JSDoc\n */\n\n\nvar Middleware = /*#__PURE__*/function () {\n  function Middleware(fns) {\n    var _this = this;\n\n    if (fns.length === 0) {\n      // Pass through\n      fns.push(function (_, next) {\n        return next();\n      });\n    }\n\n    var _loop = function _loop() {\n      var fn = _step.value;\n\n      if (typeof fn !== 'function') {\n        throw new Error('GraphQLClient Middleware: middleware has to be of type `function`');\n      }\n\n      _this.run = function (stack) {\n        return function (opts, next) {\n          stack(opts, function () {\n            fn.apply(_this, [opts, next.bind.apply(next, [null, opts])]);\n          });\n        };\n      }(_this.run);\n    };\n\n    for (var _iterator = _createForOfIteratorHelperLoose(fns), _step; !(_step = _iterator()).done;) {\n      _loop();\n    }\n  }\n  /**\n   * Run middleware\n   * @param {opts.client} GraphQLClient instance\n   * @param {opts.operation} Operation object with properties such as query and variables\n   * @param {opts.resolve} Used to early resolve the request\n   * @param {opts.addResponseHook} Hook that accepts a function that will be run after response is fetched\n   * @param {opts.reject} User to early reject the request\n   * @param {function} next\n   */\n\n\n  var _proto = Middleware.prototype;\n\n  _proto.run = function run(opts, next) {\n    next.apply(this, opts);\n  };\n\n  return Middleware;\n}();\n/**\n * Pipe with support for async functions\n * @param {array} array of functions\n * @returns single function\n */\n\n\nvar pipeP = function pipeP(fns) {\n  return function (arg) {\n    return fns.reduce(function (p, f) {\n      return p.then(f);\n    }, Promise.resolve(arg));\n  };\n};\n\nvar GraphQLClient = /*#__PURE__*/function () {\n  function GraphQLClient(config) {\n    if (config === void 0) {\n      config = {};\n    } // validate config\n\n\n    this.fullWsTransport = config.fullWsTransport;\n    this.subscriptionClient = config.subscriptionClient;\n\n    if (typeof this.subscriptionClient === 'function') {\n      this.subscriptionClient = this.subscriptionClient();\n    }\n\n    this.verifyConfig(config);\n    this.cache = config.cache;\n    this.headers = config.headers || {};\n    this.ssrMode = config.ssrMode;\n    this.ssrPromises = [];\n    this.url = config.url;\n    this.fetch = config.fetch || typeof fetch !== 'undefined' && fetch && fetch.bind();\n    this.fetchOptions = config.fetchOptions || {};\n    this.FormData = config.FormData || (typeof FormData !== 'undefined' ? FormData : undefined);\n    this.logErrors = config.logErrors !== undefined ? config.logErrors : true;\n    this.onError = config.onError;\n    this.useGETForQueries = config.useGETForQueries === true;\n    this.middleware = new Middleware(config.middleware || []);\n    this.mutationsEmitter = new EventEmitter();\n  }\n  /** Checks that the given config has the correct required options */\n\n\n  var _proto = GraphQLClient.prototype;\n\n  _proto.verifyConfig = function verifyConfig(config) {\n    if (!config.url) {\n      if (this.fullWsTransport) {\n        // check if there's a subscriptionClient\n        if (!this.subscriptionClient) {\n          throw new Error('GraphQLClient: subscriptionClient is required');\n        }\n      } else {\n        throw new Error('GraphQLClient: config.url is required');\n      }\n    }\n\n    if (config.fetch && typeof config.fetch !== 'function') {\n      throw new Error('GraphQLClient: config.fetch must be a function');\n    }\n\n    if ((canUseDOM() || config.ssrMode) && !config.fetch && typeof fetch !== 'function') {\n      throw new Error('GraphQLClient: fetch must be polyfilled or passed in new GraphQLClient({ fetch })');\n    }\n\n    if (config.ssrMode && !config.cache) {\n      throw new Error('GraphQLClient: config.cache is required when in ssrMode');\n    }\n  };\n\n  _proto.setHeader = function setHeader(key, value) {\n    this.headers[key] = value;\n    return this;\n  };\n\n  _proto.setHeaders = function setHeaders(headers) {\n    this.headers = headers;\n    return this;\n  };\n\n  _proto.removeHeader = function removeHeader(key) {\n    delete this.headers[key];\n    return this;\n  }\n  /* eslint-disable no-console */\n  ;\n\n  _proto.logErrorResult = function logErrorResult(_ref) {\n    var result = _ref.result,\n        operation = _ref.operation;\n    console.error('GraphQL Hooks Error');\n    console.groupCollapsed('---> Full Error Details');\n    console.groupCollapsed('Operation:');\n    console.log(operation);\n    console.groupEnd();\n    var error = result.error;\n\n    if (error) {\n      if (error.fetchError) {\n        console.groupCollapsed('FETCH ERROR:');\n        console.log(error.fetchError);\n        console.groupEnd();\n      }\n\n      if (error.httpError) {\n        console.groupCollapsed('HTTP ERROR:');\n        console.log(error.httpError);\n        console.groupEnd();\n      }\n\n      if (error.graphQLErrors && error.graphQLErrors.length > 0) {\n        console.groupCollapsed('GRAPHQL ERROR:');\n        error.graphQLErrors.forEach(function (err) {\n          return console.log(err);\n        });\n        console.groupEnd();\n      }\n    }\n\n    console.groupEnd();\n  }\n  /* eslint-enable no-console */\n  ;\n\n  _proto.generateResult = function generateResult(_ref2) {\n    var fetchError = _ref2.fetchError,\n        httpError = _ref2.httpError,\n        graphQLErrors = _ref2.graphQLErrors,\n        data = _ref2.data;\n    var errorFound = !!(graphQLErrors && graphQLErrors.length > 0 || fetchError || httpError);\n    return !errorFound ? {\n      data: data\n    } : {\n      data: data,\n      error: {\n        fetchError: fetchError,\n        httpError: httpError,\n        graphQLErrors: graphQLErrors\n      }\n    };\n  };\n\n  _proto.getCacheKey = function getCacheKey(operation, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var fetchOptions = _objectSpread2(_objectSpread2({}, this.fetchOptions), options.fetchOptionsOverrides);\n\n    return {\n      operation: operation,\n      fetchOptions: fetchOptions\n    };\n  };\n\n  _proto.getCache = function getCache(cacheKey) {\n    var cacheHit = this.cache ? this.cache.get(cacheKey) : null;\n\n    if (cacheHit) {\n      return cacheHit;\n    }\n  };\n\n  _proto.saveCache = function saveCache(cacheKey, value) {\n    if (this.cache) {\n      this.cache.set(cacheKey, value);\n    }\n  } // Kudos to Jayden Seric (@jaydenseric) for this piece of code.\n  // See original source: https://github.com/jaydenseric/graphql-react/blob/82d576b5fe6664c4a01cd928d79f33ddc3f7bbfd/src/universal/graphqlFetchOptions.mjs.\n  ;\n\n  _proto.getFetchOptions = function getFetchOptions(operation, fetchOptionsOverrides) {\n    if (fetchOptionsOverrides === void 0) {\n      fetchOptionsOverrides = {};\n    }\n\n    var fetchOptions = _objectSpread2(_objectSpread2({\n      method: 'POST',\n      headers: _objectSpread2({}, this.headers)\n    }, this.fetchOptions), fetchOptionsOverrides);\n\n    if (fetchOptions.method === 'GET') {\n      return fetchOptions;\n    }\n\n    var _extractFiles = extractFiles(operation, '', isExtractableFileEnhanced),\n        clone = _extractFiles.clone,\n        files = _extractFiles.files;\n\n    var operationJSON = JSON.stringify(clone);\n\n    if (files.size) {\n      // See the GraphQL multipart request spec:\n      // https://github.com/jaydenseric/graphql-multipart-request-spec\n      if (!this.FormData) {\n        throw new Error('GraphQLClient: FormData must be polyfilled or passed in new GraphQLClient({ FormData })');\n      }\n\n      var form = new this.FormData();\n      form.append('operations', operationJSON);\n      var map = {};\n      var i = 0;\n      files.forEach(function (paths) {\n        map[++i] = paths;\n      });\n      form.append('map', JSON.stringify(map));\n      i = 0;\n      files.forEach(function (paths, file) {\n        form.append(\"\" + ++i, file, file.name);\n      });\n      fetchOptions.body = form;\n    } else {\n      fetchOptions.headers['Content-Type'] = 'application/json';\n      fetchOptions.body = operationJSON;\n    }\n\n    return fetchOptions;\n  };\n\n  _proto.request = function request(operation, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var responseHandlers = [];\n\n    var addResponseHook = function addResponseHook(handler) {\n      return responseHandlers.push(handler);\n    };\n\n    return new Promise(function (resolve, reject) {\n      return _this.middleware.run({\n        operation: operation,\n        client: _this,\n        addResponseHook: addResponseHook,\n        resolve: resolve,\n        reject: reject\n      }, function (_ref3) {\n        var updatedOperation = _ref3.operation;\n\n        var transformResponse = function transformResponse(res) {\n          if (responseHandlers.length > 0) {\n            // Pipe for promises\n            return pipeP(responseHandlers)(res);\n          }\n\n          return res;\n        };\n\n        if (_this.fullWsTransport) {\n          return _this.requestViaWS(updatedOperation).then(transformResponse).then(resolve).catch(reject);\n        }\n\n        if (_this.url) {\n          return _this.requestViaHttp(updatedOperation, options).then(transformResponse).then(resolve).catch(reject);\n        }\n\n        reject(new Error('GraphQLClient: config.url is required'));\n      });\n    });\n  };\n\n  _proto.requestViaHttp = function requestViaHttp(operation, options) {\n    var _this2 = this;\n\n    var url = this.url;\n    var fetchOptions = this.getFetchOptions(operation, options.fetchOptionsOverrides);\n\n    if (fetchOptions.method === 'GET') {\n      var paramsQueryString = Object.entries(operation).filter(function (_ref4) {\n        var k = _ref4[0],\n            v = _ref4[1];\n        return options.hashOnly ? k === 'variables' : !!v;\n      }).map(function (_ref5) {\n        var k = _ref5[0],\n            v = _ref5[1];\n\n        if (k === 'variables') {\n          v = JSON.stringify(v);\n        }\n\n        return k + \"=\" + encodeURIComponent(v);\n      }).join('&');\n      url = url + '?' + paramsQueryString;\n\n      if (operation.hash) {\n        var extensions = encodeURIComponent(JSON.stringify({\n          persistedQuery: {\n            version: 1,\n            sha256Hash: operation.hash\n          }\n        }));\n        url += \"&extensions=\" + extensions;\n      }\n    }\n\n    return this.fetch(url, fetchOptions).then(function (response) {\n      if (!response.ok) {\n        return response.text().then(function (body) {\n          var status = response.status,\n              statusText = response.statusText;\n          return _this2.generateResult({\n            httpError: {\n              status: status,\n              statusText: statusText,\n              body: body\n            }\n          });\n        });\n      } else {\n        return response.json().then(function (_ref6) {\n          var errors = _ref6.errors,\n              data = _ref6.data;\n          return _this2.generateResult({\n            graphQLErrors: errors,\n            data: // enrich data with responseReducer if defined\n            typeof options.responseReducer === 'function' && options.responseReducer(data, response) || data\n          });\n        });\n      }\n    }).catch(function (error) {\n      return _this2.generateResult({\n        fetchError: error\n      });\n    }).then(function (result) {\n      if (result.error) {\n        if (_this2.logErrors) {\n          _this2.logErrorResult({\n            result: result,\n            operation: operation\n          });\n        }\n\n        if (_this2.onError) {\n          _this2.onError({\n            result: result,\n            operation: operation\n          });\n        }\n      }\n\n      return result;\n    });\n  };\n\n  _proto.requestViaWS = function requestViaWS(operationPayload) {\n    var _this3 = this;\n\n    return new Promise(function (resolve, reject) {\n      var data;\n\n      try {\n        var observable = _this3.createSubscription(operationPayload);\n\n        var subscription = observable.subscribe({\n          next: function next(result) {\n            data = result;\n          },\n          error: reject,\n          complete: function complete() {\n            subscription.unsubscribe();\n            resolve(data);\n          }\n        });\n      } catch (e) {\n        reject(e);\n      }\n    });\n  };\n\n  _proto.createSubscription = function createSubscription(operationPayload) {\n    var _this4 = this;\n\n    if (!this.subscriptionClient) {\n      throw new Error('No SubscriptionClient! Please set in the constructor.');\n    }\n\n    if (typeof this.subscriptionClient.subscribe === 'function') {\n      // graphql-ws\n      return {\n        subscribe: function subscribe(sink) {\n          return {\n            unsubscribe: _this4.subscriptionClient.subscribe(operationPayload, sink)\n          };\n        }\n      };\n    } else {\n      // subscriptions-transport-ws\n      return this.subscriptionClient.request(operationPayload);\n    }\n  };\n\n  return GraphQLClient;\n}();\n/** Used to easily mock a query returning an error when using the `LocalGraphQLClient` */\n\n\nvar LocalGraphQLError = function LocalGraphQLError(error) {\n  this.fetchError = error.fetchError;\n  this.httpError = error.httpError;\n  this.graphQLErrors = error.graphQLErrors;\n};\n/** Local version of the GraphQLClient which only returns specified queries\n * Meant to be used as a way to easily mock and test queries during development. This client never contacts any actual server.\n * Queries are given in the form of an object of functions.\n * Example:\n ```\n    const localQueries = {\n      [allPostsQuery]: () => ({\n        allPosts: [\n          {\n            id: 1,\n            title: 'Test',\n            url: 'https://example.com'\n          }\n        ]\n      }),\n      [createPostMutation]: () => ({ createPost: { id: 1 } }),\n    }\n    const client = new LocalGraphQLClient({ localQueries })\n  ```\n */\n\n\nvar LocalGraphQLClient = /*#__PURE__*/function (_GraphQLClient) {\n  _inheritsLoose(LocalGraphQLClient, _GraphQLClient);\n\n  function LocalGraphQLClient(config) {\n    var _this;\n\n    if (config === void 0) {\n      config = {};\n    }\n\n    _this = _GraphQLClient.call(this, config) || this;\n    _this.localQueries = config.localQueries;\n    _this.requestDelayMs = config.requestDelayMs || 0;\n\n    if (!_this.localQueries) {\n      throw new Error('LocalGraphQLClient: `localQueries` object required in the constructor options');\n    }\n\n    return _this;\n  }\n\n  var _proto = LocalGraphQLClient.prototype;\n\n  _proto.verifyConfig = function verifyConfig() {// Skips all config verification from the parent class because we're mocking the client\n  };\n\n  _proto.request = function request(operation) {\n    var _this2 = this;\n\n    if (!this.localQueries[operation.query]) {\n      throw new Error(\"LocalGraphQLClient: no query match for: \" + operation.query);\n    }\n\n    return timeoutPromise(this.requestDelayMs).then(function () {\n      return Promise.resolve(_this2.localQueries[operation.query](operation.variables, operation.operationName));\n    }).then(function (result) {\n      if (result instanceof LocalGraphQLError) {\n        return {\n          error: result\n        };\n      }\n\n      return {\n        data: result\n      };\n    });\n  };\n\n  return LocalGraphQLClient;\n}(GraphQLClient);\n\nfunction timeoutPromise(delayInMs) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, delayInMs);\n  });\n}\n\nvar actionTypes = {\n  RESET_STATE: 'RESET_STATE',\n  LOADING: 'LOADING',\n  CACHE_HIT: 'CACHE_HIT',\n  REQUEST_RESULT: 'REQUEST_RESULT'\n};\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case actionTypes.RESET_STATE:\n      return action.initialState;\n\n    case actionTypes.LOADING:\n      // if the previous action resulted in an error - refetch should clear any errors\n      if (state.error) {\n        return _objectSpread2(_objectSpread2({}, action.initialState), {}, {\n          data: state.data,\n          loading: true\n        });\n      }\n\n      if (state.loading) {\n        return state; // saves a render cycle as state is the same\n      }\n\n      return _objectSpread2(_objectSpread2({}, state), {}, {\n        loading: true\n      });\n\n    case actionTypes.CACHE_HIT:\n      if (state.cacheHit && !action.resetState) {\n        // we can be sure this is the same cacheKey hit\n        // because we dispatch RESET_STATE if it changes\n        return state;\n      }\n\n      return _objectSpread2(_objectSpread2({}, action.result), {}, {\n        cacheHit: true,\n        loading: false\n      });\n\n    case actionTypes.REQUEST_RESULT:\n      return _objectSpread2(_objectSpread2({}, action.result), {}, {\n        data: state.data && action.result.data && action.updateData ? action.updateData(state.data, action.result.data) : action.result.data,\n        cacheHit: false,\n        loading: false\n      });\n\n    default:\n      return state;\n  }\n}\n\nfunction useDeepCompareCallback(callback, deps) {\n  var ref = React.useRef();\n\n  if (!dequal(deps, ref.current)) {\n    ref.current = deps;\n  }\n\n  return React.useCallback(callback, ref.current);\n}\n/*\n  options include:\n\n  opts.variables: Object\n  opts.operationName: String\n  opts.fetchOptionsOverrides: Object\n  opts.skipCache: Boolean\n*/\n\n\nfunction useClientRequest(query, initialOpts) {\n  if (initialOpts === void 0) {\n    initialOpts = {};\n  }\n\n  if (typeof query !== 'string') {\n    throw new Error('Your query must be a string. If you are using the `gql` template literal from graphql-tag, remove it from your query.');\n  }\n\n  var contextClient = React.useContext(ClientContext);\n  var client = initialOpts.client || contextClient;\n  var isMounted = React.useRef(true);\n  var activeCacheKey = React.useRef(null);\n  var operation = {\n    query: query,\n    variables: initialOpts.variables,\n    operationName: initialOpts.operationName,\n    persisted: initialOpts.persisted\n  };\n\n  if (initialOpts.persisted || client.useGETForQueries && !initialOpts.isMutation) {\n    initialOpts.fetchOptionsOverrides = _objectSpread2(_objectSpread2({}, initialOpts.fetchOptionsOverrides), {}, {\n      method: 'GET'\n    });\n  }\n\n  var cacheKey = client.getCacheKey(operation, initialOpts);\n  var isDeferred = initialOpts.isMutation || initialOpts.isManual;\n  var initialCacheHit = initialOpts.skipCache || !client.cache ? null : client.cache.get(cacheKey);\n\n  var initialState = _objectSpread2(_objectSpread2({}, initialCacheHit), {}, {\n    cacheHit: !!initialCacheHit,\n    loading: isDeferred ? false : !initialCacheHit\n  });\n\n  var _React$useReducer = React.useReducer(reducer, initialState),\n      state = _React$useReducer[0],\n      dispatch = _React$useReducer[1]; // NOTE: state from useReducer is only initialState on the first render\n  // in subsequent renders the operation could have changed\n  // if so the state would be invalid, this effect ensures we reset it back\n\n\n  var stringifiedCacheKey = JSON.stringify(cacheKey);\n  React.useEffect(function () {\n    if (!initialOpts.updateData) {\n      // if using updateData we can assume that the consumer cares about the previous data\n      dispatch({\n        type: actionTypes.RESET_STATE,\n        initialState: initialState\n      });\n    }\n  }, [stringifiedCacheKey]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(function () {\n    isMounted.current = true;\n    return function () {\n      isMounted.current = false;\n    };\n  }, []); // arguments to fetchData override the useClientRequest arguments\n\n  var fetchData = useDeepCompareCallback(function (newOpts) {\n    var revisedOpts = _objectSpread2(_objectSpread2({}, initialOpts), newOpts);\n\n    var revisedOperation = _objectSpread2(_objectSpread2({}, operation), {}, {\n      variables: revisedOpts.variables,\n      operationName: revisedOpts.operationName\n    });\n\n    if (!isMounted.current) {\n      return Promise.resolve({\n        error: {\n          fetchError: new Error('fetchData should not be called after hook unmounted')\n        },\n        loading: false,\n        cacheHit: false\n      });\n    }\n\n    var revisedCacheKey = client.getCacheKey(revisedOperation, revisedOpts); // NOTE: There is a possibility of a race condition whereby\n    // the second query could finish before the first one, dispatching an old result\n    // see https://github.com/nearform/graphql-hooks/issues/150\n\n    activeCacheKey.current = revisedCacheKey;\n    var cacheHit = revisedOpts.skipCache ? null : client.getCache(revisedCacheKey);\n\n    if (cacheHit) {\n      dispatch({\n        type: actionTypes.CACHE_HIT,\n        result: cacheHit,\n        resetState: stringifiedCacheKey !== JSON.stringify(state.cacheKey)\n      });\n      return Promise.resolve(cacheHit);\n    }\n\n    dispatch({\n      type: actionTypes.LOADING,\n      initialState: initialState\n    });\n    return client.request(revisedOperation, revisedOpts).then(function (result) {\n      if (revisedOpts.updateData && typeof revisedOpts.updateData !== 'function') {\n        throw new Error('options.updateData must be a function');\n      }\n\n      var actionResult = _objectSpread2({}, result);\n\n      if (revisedOpts.useCache) {\n        actionResult.useCache = true;\n        actionResult.cacheKey = revisedCacheKey;\n\n        if (client.ssrMode) {\n          var cacheValue = {\n            error: actionResult.error,\n            data: revisedOpts.updateData ? revisedOpts.updateData(state.data, actionResult.data) : actionResult.data\n          };\n          client.saveCache(revisedCacheKey, cacheValue);\n        }\n      }\n\n      if (isMounted.current && revisedCacheKey === activeCacheKey.current) {\n        dispatch({\n          type: actionTypes.REQUEST_RESULT,\n          updateData: revisedOpts.updateData,\n          result: actionResult\n        });\n      }\n\n      if (initialOpts.isMutation) {\n        client.mutationsEmitter.emit(query, _objectSpread2(_objectSpread2({}, revisedOperation), {}, {\n          mutation: query,\n          result: actionResult\n        }));\n      }\n\n      return result;\n    });\n  }, [client, initialOpts, operation]); // We perform caching after reducer update\n  // to include the outcome of updateData.\n  // The cache is already saved if in ssrMode.\n\n  React.useEffect(function () {\n    if (state.useCache && !client.ssrMode) {\n      client.saveCache(state.cacheKey, state);\n    }\n  }, [client, state]);\n\n  var reset = function reset(desiredState) {\n    if (desiredState === void 0) {\n      desiredState = {};\n    }\n\n    return dispatch({\n      type: actionTypes.RESET_STATE,\n      initialState: _objectSpread2(_objectSpread2({}, initialState), desiredState)\n    });\n  };\n\n  return [fetchData, state, reset];\n}\n/**\n * Checks values of refetchAfterMutations public option and maps them to an object\n * @typedef {import('../index').RefetchAferMutationsData} RefetchAferMutationsData\n *\n * @param {RefetchAferMutationsData} refetchAfterMutations\n * @returns {object}\n */\n\n\nfunction createRefetchMutationsMap(refetchAfterMutations) {\n  var mutations = Array.isArray(refetchAfterMutations) ? refetchAfterMutations : [refetchAfterMutations];\n  var result = {};\n  mutations.forEach(function (mutationInfo) {\n    if (mutationInfo == null) return;\n    var paramType = typeof mutationInfo;\n\n    if (paramType === 'string') {\n      result[mutationInfo] = {};\n    } else if (paramType === 'object') {\n      var filter = mutationInfo.filter,\n          mutation = mutationInfo.mutation;\n      result[mutation] = {\n        filter: filter\n      };\n    }\n  });\n  return result;\n}\n\nvar defaultOpts = {\n  useCache: true,\n  skip: false,\n  throwErrors: false\n};\n\nfunction useQuery(query, opts) {\n  if (opts === void 0) {\n    opts = {};\n  }\n\n  var allOpts = _objectSpread2(_objectSpread2({}, defaultOpts), opts);\n\n  var contextClient = React.useContext(ClientContext);\n  var client = opts.client || contextClient;\n\n  var _React$useState = React.useState(false),\n      calledDuringSSR = _React$useState[0],\n      setCalledDuringSSR = _React$useState[1];\n\n  var _useClientRequest = useClientRequest(query, allOpts),\n      queryReq = _useClientRequest[0],\n      state = _useClientRequest[1];\n\n  if (client.ssrMode && opts.ssr !== false && !calledDuringSSR && !opts.skipCache && !opts.skip) {\n    // result may already be in the cache from previous SSR iterations\n    if (!state.data && !state.error) {\n      var p = queryReq();\n      client.ssrPromises.push(p);\n    }\n\n    setCalledDuringSSR(true);\n  }\n\n  var stringifiedAllOpts = JSON.stringify(allOpts);\n  React.useEffect(function () {\n    if (allOpts.skip) {\n      return;\n    }\n\n    queryReq();\n  }, [query, stringifiedAllOpts]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(function () {\n    if (state.error && allOpts.throwErrors) {\n      throw state.error;\n    }\n  }, [state.error, allOpts.throwErrors]);\n  var refetch = React.useCallback(function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return queryReq(_objectSpread2({\n      skipCache: true,\n      // don't call the updateData that has been passed into useQuery here\n      // reset to the default behaviour of returning the raw query result\n      // this can be overridden in refetch options\n      updateData: function updateData(_, data) {\n        return data;\n      }\n    }, options));\n  }, [queryReq]);\n  React.useEffect(function subscribeToMutationsAndRefetch() {\n    var mutationsMap = createRefetchMutationsMap(opts.refetchAfterMutations);\n    var mutations = Object.keys(mutationsMap);\n\n    var conditionalRefetch = function conditionalRefetch(_ref) {\n      var mutation = _ref.mutation,\n          variables = _ref.variables;\n      var filter = mutationsMap[mutation].filter;\n\n      if (!filter || variables && filter(variables)) {\n        refetch();\n      }\n    };\n\n    mutations.forEach(function (mutation) {\n      // this event is emitted from useClientRequest\n      client.mutationsEmitter.on(mutation, conditionalRefetch);\n    });\n    return function () {\n      mutations.forEach(function (mutation) {\n        client.mutationsEmitter.removeListener(mutation, conditionalRefetch);\n      });\n    };\n  }, [opts.refetchAfterMutations, refetch, client.mutationsEmitter]);\n  return _objectSpread2(_objectSpread2({}, state), {}, {\n    refetch: refetch\n  });\n}\n\nfunction useSubscription(options, callback) {\n  var callbackRef = useRef(callback);\n  callbackRef.current = callback;\n  var contextClient = useContext(ClientContext);\n  var client = options.client || contextClient;\n  var request = {\n    query: options.query,\n    variables: options.variables\n  };\n  useEffect(function () {\n    var observable = client.createSubscription(request);\n    var subscription = observable.subscribe({\n      next: function next(result) {\n        callbackRef.current(result);\n      },\n      error: function error(errors) {\n        callbackRef.current({\n          errors: errors\n        });\n      },\n      complete: function complete() {\n        subscription.unsubscribe();\n      }\n    });\n    return function () {\n      subscription.unsubscribe();\n    };\n  }, []); // eslint-disable-line\n  // the effect should be run when component is mounted and unmounted\n}\n\nvar useManualQuery = function useManualQuery(query, options) {\n  return useClientRequest(query, _objectSpread2({\n    useCache: true,\n    isManual: true\n  }, options));\n};\n\nvar useMutation = function useMutation(query, options) {\n  return useClientRequest(query, _objectSpread2({\n    isMutation: true\n  }, options));\n};\n\nexport { ClientContext, GraphQLClient, LocalGraphQLClient, LocalGraphQLError, useClientRequest, useManualQuery, useMutation, useQuery, useSubscription };","map":{"version":3,"sources":["D:/Will/Egitial_Assessment/client/node_modules/graphql-hooks/es/graphql-hooks.js"],"names":["React","useRef","useContext","useEffect","EventEmitter","isExtractableFile","extractFiles","dequal","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","_inheritsLoose","subClass","superClass","prototype","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_unsupportedIterableToArray","minLen","_arrayLikeToArray","n","toString","call","slice","name","Array","from","test","arr","len","arr2","_createForOfIteratorHelperLoose","allowArrayLike","it","Symbol","iterator","next","bind","isArray","done","TypeError","ClientContext","createContext","displayName","canUseDOM","window","document","createElement","isExtractableFileEnhanced","pipe","stream","Middleware","fns","_this","_","_loop","fn","_step","Error","run","stack","opts","_iterator","_proto","pipeP","arg","reduce","f","then","Promise","resolve","GraphQLClient","config","fullWsTransport","subscriptionClient","verifyConfig","cache","headers","ssrMode","ssrPromises","url","fetch","fetchOptions","FormData","undefined","logErrors","onError","useGETForQueries","middleware","mutationsEmitter","setHeader","setHeaders","removeHeader","logErrorResult","_ref","result","operation","console","error","groupCollapsed","log","groupEnd","fetchError","httpError","graphQLErrors","err","generateResult","_ref2","data","errorFound","getCacheKey","options","fetchOptionsOverrides","getCache","cacheKey","cacheHit","get","saveCache","set","getFetchOptions","method","_extractFiles","clone","files","operationJSON","JSON","stringify","size","form","append","map","paths","file","body","request","responseHandlers","addResponseHook","handler","reject","client","_ref3","updatedOperation","transformResponse","res","requestViaWS","catch","requestViaHttp","_this2","paramsQueryString","entries","_ref4","k","v","hashOnly","_ref5","encodeURIComponent","join","hash","extensions","persistedQuery","version","sha256Hash","response","ok","text","status","statusText","json","_ref6","errors","responseReducer","operationPayload","_this3","observable","createSubscription","subscription","subscribe","complete","unsubscribe","e","_this4","sink","LocalGraphQLError","LocalGraphQLClient","_GraphQLClient","localQueries","requestDelayMs","query","timeoutPromise","variables","operationName","delayInMs","setTimeout","actionTypes","RESET_STATE","LOADING","CACHE_HIT","REQUEST_RESULT","reducer","state","action","type","initialState","loading","resetState","updateData","useDeepCompareCallback","callback","deps","ref","current","useCallback","useClientRequest","initialOpts","contextClient","isMounted","activeCacheKey","persisted","isMutation","isDeferred","isManual","initialCacheHit","skipCache","_React$useReducer","useReducer","dispatch","stringifiedCacheKey","fetchData","newOpts","revisedOpts","revisedOperation","revisedCacheKey","actionResult","useCache","cacheValue","emit","mutation","reset","desiredState","createRefetchMutationsMap","refetchAfterMutations","mutations","mutationInfo","paramType","defaultOpts","skip","throwErrors","useQuery","allOpts","_React$useState","useState","calledDuringSSR","setCalledDuringSSR","_useClientRequest","queryReq","ssr","stringifiedAllOpts","refetch","subscribeToMutationsAndRefetch","mutationsMap","conditionalRefetch","on","removeListener","useSubscription","callbackRef","useManualQuery","useMutation"],"mappings":"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","sourcesContent":["import React, { useRef, useContext, useEffect } from 'react';\nimport EventEmitter from 'events';\nimport { isExtractableFile, extractFiles } from 'extract-files';\nimport { dequal } from 'dequal';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar ClientContext = React.createContext();\nClientContext.displayName = 'ClientContext';\n\nvar canUseDOM = (function () {\n  return typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined';\n});\n\nvar isExtractableFileEnhanced = function isExtractableFileEnhanced(value) {\n  return isExtractableFile(value) || // Check if stream\n  // https://github.com/sindresorhus/is-stream/blob/3750505b0727f6df54324784fe369365ef78841e/index.js#L3\n  value !== null && typeof value === 'object' && typeof value.pipe === 'function' || // Check if formdata-node File\n  // https://github.com/octet-stream/form-data/blob/14a6708f0ae28a5ffded8b6f8156394ba1d1244e/lib/File.ts#L29\n  value !== null && typeof value === 'object' && typeof value.stream === 'function';\n};\n\n/**\n * Generic Middleware function that\n * will run object through all provided functions\n *\n *\n * Minimal example:\n * const MyMiddleware = ({ operation }, next) => {\n *   operation.variables.user = 'admin'\n *   next()\n * }\n *\n * All parameters provided are written in run function JSDoc\n */\nvar Middleware = /*#__PURE__*/function () {\n  function Middleware(fns) {\n    var _this = this;\n\n    if (fns.length === 0) {\n      // Pass through\n      fns.push(function (_, next) {\n        return next();\n      });\n    }\n\n    var _loop = function _loop() {\n      var fn = _step.value;\n\n      if (typeof fn !== 'function') {\n        throw new Error('GraphQLClient Middleware: middleware has to be of type `function`');\n      }\n\n      _this.run = function (stack) {\n        return function (opts, next) {\n          stack(opts, function () {\n            fn.apply(_this, [opts, next.bind.apply(next, [null, opts])]);\n          });\n        };\n      }(_this.run);\n    };\n\n    for (var _iterator = _createForOfIteratorHelperLoose(fns), _step; !(_step = _iterator()).done;) {\n      _loop();\n    }\n  }\n  /**\n   * Run middleware\n   * @param {opts.client} GraphQLClient instance\n   * @param {opts.operation} Operation object with properties such as query and variables\n   * @param {opts.resolve} Used to early resolve the request\n   * @param {opts.addResponseHook} Hook that accepts a function that will be run after response is fetched\n   * @param {opts.reject} User to early reject the request\n   * @param {function} next\n   */\n\n\n  var _proto = Middleware.prototype;\n\n  _proto.run = function run(opts, next) {\n    next.apply(this, opts);\n  };\n\n  return Middleware;\n}();\n\n/**\n * Pipe with support for async functions\n * @param {array} array of functions\n * @returns single function\n */\nvar pipeP = function pipeP(fns) {\n  return function (arg) {\n    return fns.reduce(function (p, f) {\n      return p.then(f);\n    }, Promise.resolve(arg));\n  };\n};\n\nvar GraphQLClient = /*#__PURE__*/function () {\n  function GraphQLClient(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    // validate config\n    this.fullWsTransport = config.fullWsTransport;\n    this.subscriptionClient = config.subscriptionClient;\n\n    if (typeof this.subscriptionClient === 'function') {\n      this.subscriptionClient = this.subscriptionClient();\n    }\n\n    this.verifyConfig(config);\n    this.cache = config.cache;\n    this.headers = config.headers || {};\n    this.ssrMode = config.ssrMode;\n    this.ssrPromises = [];\n    this.url = config.url;\n    this.fetch = config.fetch || typeof fetch !== 'undefined' && fetch && fetch.bind();\n    this.fetchOptions = config.fetchOptions || {};\n    this.FormData = config.FormData || (typeof FormData !== 'undefined' ? FormData : undefined);\n    this.logErrors = config.logErrors !== undefined ? config.logErrors : true;\n    this.onError = config.onError;\n    this.useGETForQueries = config.useGETForQueries === true;\n    this.middleware = new Middleware(config.middleware || []);\n    this.mutationsEmitter = new EventEmitter();\n  }\n  /** Checks that the given config has the correct required options */\n\n\n  var _proto = GraphQLClient.prototype;\n\n  _proto.verifyConfig = function verifyConfig(config) {\n    if (!config.url) {\n      if (this.fullWsTransport) {\n        // check if there's a subscriptionClient\n        if (!this.subscriptionClient) {\n          throw new Error('GraphQLClient: subscriptionClient is required');\n        }\n      } else {\n        throw new Error('GraphQLClient: config.url is required');\n      }\n    }\n\n    if (config.fetch && typeof config.fetch !== 'function') {\n      throw new Error('GraphQLClient: config.fetch must be a function');\n    }\n\n    if ((canUseDOM() || config.ssrMode) && !config.fetch && typeof fetch !== 'function') {\n      throw new Error('GraphQLClient: fetch must be polyfilled or passed in new GraphQLClient({ fetch })');\n    }\n\n    if (config.ssrMode && !config.cache) {\n      throw new Error('GraphQLClient: config.cache is required when in ssrMode');\n    }\n  };\n\n  _proto.setHeader = function setHeader(key, value) {\n    this.headers[key] = value;\n    return this;\n  };\n\n  _proto.setHeaders = function setHeaders(headers) {\n    this.headers = headers;\n    return this;\n  };\n\n  _proto.removeHeader = function removeHeader(key) {\n    delete this.headers[key];\n    return this;\n  }\n  /* eslint-disable no-console */\n  ;\n\n  _proto.logErrorResult = function logErrorResult(_ref) {\n    var result = _ref.result,\n        operation = _ref.operation;\n    console.error('GraphQL Hooks Error');\n    console.groupCollapsed('---> Full Error Details');\n    console.groupCollapsed('Operation:');\n    console.log(operation);\n    console.groupEnd();\n    var error = result.error;\n\n    if (error) {\n      if (error.fetchError) {\n        console.groupCollapsed('FETCH ERROR:');\n        console.log(error.fetchError);\n        console.groupEnd();\n      }\n\n      if (error.httpError) {\n        console.groupCollapsed('HTTP ERROR:');\n        console.log(error.httpError);\n        console.groupEnd();\n      }\n\n      if (error.graphQLErrors && error.graphQLErrors.length > 0) {\n        console.groupCollapsed('GRAPHQL ERROR:');\n        error.graphQLErrors.forEach(function (err) {\n          return console.log(err);\n        });\n        console.groupEnd();\n      }\n    }\n\n    console.groupEnd();\n  }\n  /* eslint-enable no-console */\n  ;\n\n  _proto.generateResult = function generateResult(_ref2) {\n    var fetchError = _ref2.fetchError,\n        httpError = _ref2.httpError,\n        graphQLErrors = _ref2.graphQLErrors,\n        data = _ref2.data;\n    var errorFound = !!(graphQLErrors && graphQLErrors.length > 0 || fetchError || httpError);\n    return !errorFound ? {\n      data: data\n    } : {\n      data: data,\n      error: {\n        fetchError: fetchError,\n        httpError: httpError,\n        graphQLErrors: graphQLErrors\n      }\n    };\n  };\n\n  _proto.getCacheKey = function getCacheKey(operation, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var fetchOptions = _objectSpread2(_objectSpread2({}, this.fetchOptions), options.fetchOptionsOverrides);\n\n    return {\n      operation: operation,\n      fetchOptions: fetchOptions\n    };\n  };\n\n  _proto.getCache = function getCache(cacheKey) {\n    var cacheHit = this.cache ? this.cache.get(cacheKey) : null;\n\n    if (cacheHit) {\n      return cacheHit;\n    }\n  };\n\n  _proto.saveCache = function saveCache(cacheKey, value) {\n    if (this.cache) {\n      this.cache.set(cacheKey, value);\n    }\n  } // Kudos to Jayden Seric (@jaydenseric) for this piece of code.\n  // See original source: https://github.com/jaydenseric/graphql-react/blob/82d576b5fe6664c4a01cd928d79f33ddc3f7bbfd/src/universal/graphqlFetchOptions.mjs.\n  ;\n\n  _proto.getFetchOptions = function getFetchOptions(operation, fetchOptionsOverrides) {\n    if (fetchOptionsOverrides === void 0) {\n      fetchOptionsOverrides = {};\n    }\n\n    var fetchOptions = _objectSpread2(_objectSpread2({\n      method: 'POST',\n      headers: _objectSpread2({}, this.headers)\n    }, this.fetchOptions), fetchOptionsOverrides);\n\n    if (fetchOptions.method === 'GET') {\n      return fetchOptions;\n    }\n\n    var _extractFiles = extractFiles(operation, '', isExtractableFileEnhanced),\n        clone = _extractFiles.clone,\n        files = _extractFiles.files;\n\n    var operationJSON = JSON.stringify(clone);\n\n    if (files.size) {\n      // See the GraphQL multipart request spec:\n      // https://github.com/jaydenseric/graphql-multipart-request-spec\n      if (!this.FormData) {\n        throw new Error('GraphQLClient: FormData must be polyfilled or passed in new GraphQLClient({ FormData })');\n      }\n\n      var form = new this.FormData();\n      form.append('operations', operationJSON);\n      var map = {};\n      var i = 0;\n      files.forEach(function (paths) {\n        map[++i] = paths;\n      });\n      form.append('map', JSON.stringify(map));\n      i = 0;\n      files.forEach(function (paths, file) {\n        form.append(\"\" + ++i, file, file.name);\n      });\n      fetchOptions.body = form;\n    } else {\n      fetchOptions.headers['Content-Type'] = 'application/json';\n      fetchOptions.body = operationJSON;\n    }\n\n    return fetchOptions;\n  };\n\n  _proto.request = function request(operation, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var responseHandlers = [];\n\n    var addResponseHook = function addResponseHook(handler) {\n      return responseHandlers.push(handler);\n    };\n\n    return new Promise(function (resolve, reject) {\n      return _this.middleware.run({\n        operation: operation,\n        client: _this,\n        addResponseHook: addResponseHook,\n        resolve: resolve,\n        reject: reject\n      }, function (_ref3) {\n        var updatedOperation = _ref3.operation;\n\n        var transformResponse = function transformResponse(res) {\n          if (responseHandlers.length > 0) {\n            // Pipe for promises\n            return pipeP(responseHandlers)(res);\n          }\n\n          return res;\n        };\n\n        if (_this.fullWsTransport) {\n          return _this.requestViaWS(updatedOperation).then(transformResponse).then(resolve).catch(reject);\n        }\n\n        if (_this.url) {\n          return _this.requestViaHttp(updatedOperation, options).then(transformResponse).then(resolve).catch(reject);\n        }\n\n        reject(new Error('GraphQLClient: config.url is required'));\n      });\n    });\n  };\n\n  _proto.requestViaHttp = function requestViaHttp(operation, options) {\n    var _this2 = this;\n\n    var url = this.url;\n    var fetchOptions = this.getFetchOptions(operation, options.fetchOptionsOverrides);\n\n    if (fetchOptions.method === 'GET') {\n      var paramsQueryString = Object.entries(operation).filter(function (_ref4) {\n        var k = _ref4[0],\n            v = _ref4[1];\n        return options.hashOnly ? k === 'variables' : !!v;\n      }).map(function (_ref5) {\n        var k = _ref5[0],\n            v = _ref5[1];\n\n        if (k === 'variables') {\n          v = JSON.stringify(v);\n        }\n\n        return k + \"=\" + encodeURIComponent(v);\n      }).join('&');\n      url = url + '?' + paramsQueryString;\n\n      if (operation.hash) {\n        var extensions = encodeURIComponent(JSON.stringify({\n          persistedQuery: {\n            version: 1,\n            sha256Hash: operation.hash\n          }\n        }));\n        url += \"&extensions=\" + extensions;\n      }\n    }\n\n    return this.fetch(url, fetchOptions).then(function (response) {\n      if (!response.ok) {\n        return response.text().then(function (body) {\n          var status = response.status,\n              statusText = response.statusText;\n          return _this2.generateResult({\n            httpError: {\n              status: status,\n              statusText: statusText,\n              body: body\n            }\n          });\n        });\n      } else {\n        return response.json().then(function (_ref6) {\n          var errors = _ref6.errors,\n              data = _ref6.data;\n          return _this2.generateResult({\n            graphQLErrors: errors,\n            data: // enrich data with responseReducer if defined\n            typeof options.responseReducer === 'function' && options.responseReducer(data, response) || data\n          });\n        });\n      }\n    }).catch(function (error) {\n      return _this2.generateResult({\n        fetchError: error\n      });\n    }).then(function (result) {\n      if (result.error) {\n        if (_this2.logErrors) {\n          _this2.logErrorResult({\n            result: result,\n            operation: operation\n          });\n        }\n\n        if (_this2.onError) {\n          _this2.onError({\n            result: result,\n            operation: operation\n          });\n        }\n      }\n\n      return result;\n    });\n  };\n\n  _proto.requestViaWS = function requestViaWS(operationPayload) {\n    var _this3 = this;\n\n    return new Promise(function (resolve, reject) {\n      var data;\n\n      try {\n        var observable = _this3.createSubscription(operationPayload);\n\n        var subscription = observable.subscribe({\n          next: function next(result) {\n            data = result;\n          },\n          error: reject,\n          complete: function complete() {\n            subscription.unsubscribe();\n            resolve(data);\n          }\n        });\n      } catch (e) {\n        reject(e);\n      }\n    });\n  };\n\n  _proto.createSubscription = function createSubscription(operationPayload) {\n    var _this4 = this;\n\n    if (!this.subscriptionClient) {\n      throw new Error('No SubscriptionClient! Please set in the constructor.');\n    }\n\n    if (typeof this.subscriptionClient.subscribe === 'function') {\n      // graphql-ws\n      return {\n        subscribe: function subscribe(sink) {\n          return {\n            unsubscribe: _this4.subscriptionClient.subscribe(operationPayload, sink)\n          };\n        }\n      };\n    } else {\n      // subscriptions-transport-ws\n      return this.subscriptionClient.request(operationPayload);\n    }\n  };\n\n  return GraphQLClient;\n}();\n\n/** Used to easily mock a query returning an error when using the `LocalGraphQLClient` */\nvar LocalGraphQLError = function LocalGraphQLError(error) {\n  this.fetchError = error.fetchError;\n  this.httpError = error.httpError;\n  this.graphQLErrors = error.graphQLErrors;\n};\n\n/** Local version of the GraphQLClient which only returns specified queries\n * Meant to be used as a way to easily mock and test queries during development. This client never contacts any actual server.\n * Queries are given in the form of an object of functions.\n * Example:\n ```\n    const localQueries = {\n      [allPostsQuery]: () => ({\n        allPosts: [\n          {\n            id: 1,\n            title: 'Test',\n            url: 'https://example.com'\n          }\n        ]\n      }),\n      [createPostMutation]: () => ({ createPost: { id: 1 } }),\n    }\n    const client = new LocalGraphQLClient({ localQueries })\n  ```\n */\n\nvar LocalGraphQLClient = /*#__PURE__*/function (_GraphQLClient) {\n  _inheritsLoose(LocalGraphQLClient, _GraphQLClient);\n\n  function LocalGraphQLClient(config) {\n    var _this;\n\n    if (config === void 0) {\n      config = {};\n    }\n\n    _this = _GraphQLClient.call(this, config) || this;\n    _this.localQueries = config.localQueries;\n    _this.requestDelayMs = config.requestDelayMs || 0;\n\n    if (!_this.localQueries) {\n      throw new Error('LocalGraphQLClient: `localQueries` object required in the constructor options');\n    }\n\n    return _this;\n  }\n\n  var _proto = LocalGraphQLClient.prototype;\n\n  _proto.verifyConfig = function verifyConfig() {// Skips all config verification from the parent class because we're mocking the client\n  };\n\n  _proto.request = function request(operation) {\n    var _this2 = this;\n\n    if (!this.localQueries[operation.query]) {\n      throw new Error(\"LocalGraphQLClient: no query match for: \" + operation.query);\n    }\n\n    return timeoutPromise(this.requestDelayMs).then(function () {\n      return Promise.resolve(_this2.localQueries[operation.query](operation.variables, operation.operationName));\n    }).then(function (result) {\n      if (result instanceof LocalGraphQLError) {\n        return {\n          error: result\n        };\n      }\n\n      return {\n        data: result\n      };\n    });\n  };\n\n  return LocalGraphQLClient;\n}(GraphQLClient);\n\nfunction timeoutPromise(delayInMs) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, delayInMs);\n  });\n}\n\nvar actionTypes = {\n  RESET_STATE: 'RESET_STATE',\n  LOADING: 'LOADING',\n  CACHE_HIT: 'CACHE_HIT',\n  REQUEST_RESULT: 'REQUEST_RESULT'\n};\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case actionTypes.RESET_STATE:\n      return action.initialState;\n\n    case actionTypes.LOADING:\n      // if the previous action resulted in an error - refetch should clear any errors\n      if (state.error) {\n        return _objectSpread2(_objectSpread2({}, action.initialState), {}, {\n          data: state.data,\n          loading: true\n        });\n      }\n\n      if (state.loading) {\n        return state; // saves a render cycle as state is the same\n      }\n\n      return _objectSpread2(_objectSpread2({}, state), {}, {\n        loading: true\n      });\n\n    case actionTypes.CACHE_HIT:\n      if (state.cacheHit && !action.resetState) {\n        // we can be sure this is the same cacheKey hit\n        // because we dispatch RESET_STATE if it changes\n        return state;\n      }\n\n      return _objectSpread2(_objectSpread2({}, action.result), {}, {\n        cacheHit: true,\n        loading: false\n      });\n\n    case actionTypes.REQUEST_RESULT:\n      return _objectSpread2(_objectSpread2({}, action.result), {}, {\n        data: state.data && action.result.data && action.updateData ? action.updateData(state.data, action.result.data) : action.result.data,\n        cacheHit: false,\n        loading: false\n      });\n\n    default:\n      return state;\n  }\n}\n\nfunction useDeepCompareCallback(callback, deps) {\n  var ref = React.useRef();\n\n  if (!dequal(deps, ref.current)) {\n    ref.current = deps;\n  }\n\n  return React.useCallback(callback, ref.current);\n}\n/*\n  options include:\n\n  opts.variables: Object\n  opts.operationName: String\n  opts.fetchOptionsOverrides: Object\n  opts.skipCache: Boolean\n*/\n\n\nfunction useClientRequest(query, initialOpts) {\n  if (initialOpts === void 0) {\n    initialOpts = {};\n  }\n\n  if (typeof query !== 'string') {\n    throw new Error('Your query must be a string. If you are using the `gql` template literal from graphql-tag, remove it from your query.');\n  }\n\n  var contextClient = React.useContext(ClientContext);\n  var client = initialOpts.client || contextClient;\n  var isMounted = React.useRef(true);\n  var activeCacheKey = React.useRef(null);\n  var operation = {\n    query: query,\n    variables: initialOpts.variables,\n    operationName: initialOpts.operationName,\n    persisted: initialOpts.persisted\n  };\n\n  if (initialOpts.persisted || client.useGETForQueries && !initialOpts.isMutation) {\n    initialOpts.fetchOptionsOverrides = _objectSpread2(_objectSpread2({}, initialOpts.fetchOptionsOverrides), {}, {\n      method: 'GET'\n    });\n  }\n\n  var cacheKey = client.getCacheKey(operation, initialOpts);\n  var isDeferred = initialOpts.isMutation || initialOpts.isManual;\n  var initialCacheHit = initialOpts.skipCache || !client.cache ? null : client.cache.get(cacheKey);\n\n  var initialState = _objectSpread2(_objectSpread2({}, initialCacheHit), {}, {\n    cacheHit: !!initialCacheHit,\n    loading: isDeferred ? false : !initialCacheHit\n  });\n\n  var _React$useReducer = React.useReducer(reducer, initialState),\n      state = _React$useReducer[0],\n      dispatch = _React$useReducer[1]; // NOTE: state from useReducer is only initialState on the first render\n  // in subsequent renders the operation could have changed\n  // if so the state would be invalid, this effect ensures we reset it back\n\n\n  var stringifiedCacheKey = JSON.stringify(cacheKey);\n  React.useEffect(function () {\n    if (!initialOpts.updateData) {\n      // if using updateData we can assume that the consumer cares about the previous data\n      dispatch({\n        type: actionTypes.RESET_STATE,\n        initialState: initialState\n      });\n    }\n  }, [stringifiedCacheKey]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(function () {\n    isMounted.current = true;\n    return function () {\n      isMounted.current = false;\n    };\n  }, []); // arguments to fetchData override the useClientRequest arguments\n\n  var fetchData = useDeepCompareCallback(function (newOpts) {\n    var revisedOpts = _objectSpread2(_objectSpread2({}, initialOpts), newOpts);\n\n    var revisedOperation = _objectSpread2(_objectSpread2({}, operation), {}, {\n      variables: revisedOpts.variables,\n      operationName: revisedOpts.operationName\n    });\n\n    if (!isMounted.current) {\n      return Promise.resolve({\n        error: {\n          fetchError: new Error('fetchData should not be called after hook unmounted')\n        },\n        loading: false,\n        cacheHit: false\n      });\n    }\n\n    var revisedCacheKey = client.getCacheKey(revisedOperation, revisedOpts); // NOTE: There is a possibility of a race condition whereby\n    // the second query could finish before the first one, dispatching an old result\n    // see https://github.com/nearform/graphql-hooks/issues/150\n\n    activeCacheKey.current = revisedCacheKey;\n    var cacheHit = revisedOpts.skipCache ? null : client.getCache(revisedCacheKey);\n\n    if (cacheHit) {\n      dispatch({\n        type: actionTypes.CACHE_HIT,\n        result: cacheHit,\n        resetState: stringifiedCacheKey !== JSON.stringify(state.cacheKey)\n      });\n      return Promise.resolve(cacheHit);\n    }\n\n    dispatch({\n      type: actionTypes.LOADING,\n      initialState: initialState\n    });\n    return client.request(revisedOperation, revisedOpts).then(function (result) {\n      if (revisedOpts.updateData && typeof revisedOpts.updateData !== 'function') {\n        throw new Error('options.updateData must be a function');\n      }\n\n      var actionResult = _objectSpread2({}, result);\n\n      if (revisedOpts.useCache) {\n        actionResult.useCache = true;\n        actionResult.cacheKey = revisedCacheKey;\n\n        if (client.ssrMode) {\n          var cacheValue = {\n            error: actionResult.error,\n            data: revisedOpts.updateData ? revisedOpts.updateData(state.data, actionResult.data) : actionResult.data\n          };\n          client.saveCache(revisedCacheKey, cacheValue);\n        }\n      }\n\n      if (isMounted.current && revisedCacheKey === activeCacheKey.current) {\n        dispatch({\n          type: actionTypes.REQUEST_RESULT,\n          updateData: revisedOpts.updateData,\n          result: actionResult\n        });\n      }\n\n      if (initialOpts.isMutation) {\n        client.mutationsEmitter.emit(query, _objectSpread2(_objectSpread2({}, revisedOperation), {}, {\n          mutation: query,\n          result: actionResult\n        }));\n      }\n\n      return result;\n    });\n  }, [client, initialOpts, operation]); // We perform caching after reducer update\n  // to include the outcome of updateData.\n  // The cache is already saved if in ssrMode.\n\n  React.useEffect(function () {\n    if (state.useCache && !client.ssrMode) {\n      client.saveCache(state.cacheKey, state);\n    }\n  }, [client, state]);\n\n  var reset = function reset(desiredState) {\n    if (desiredState === void 0) {\n      desiredState = {};\n    }\n\n    return dispatch({\n      type: actionTypes.RESET_STATE,\n      initialState: _objectSpread2(_objectSpread2({}, initialState), desiredState)\n    });\n  };\n\n  return [fetchData, state, reset];\n}\n\n/**\n * Checks values of refetchAfterMutations public option and maps them to an object\n * @typedef {import('../index').RefetchAferMutationsData} RefetchAferMutationsData\n *\n * @param {RefetchAferMutationsData} refetchAfterMutations\n * @returns {object}\n */\nfunction createRefetchMutationsMap(refetchAfterMutations) {\n  var mutations = Array.isArray(refetchAfterMutations) ? refetchAfterMutations : [refetchAfterMutations];\n  var result = {};\n  mutations.forEach(function (mutationInfo) {\n    if (mutationInfo == null) return;\n    var paramType = typeof mutationInfo;\n\n    if (paramType === 'string') {\n      result[mutationInfo] = {};\n    } else if (paramType === 'object') {\n      var filter = mutationInfo.filter,\n          mutation = mutationInfo.mutation;\n      result[mutation] = {\n        filter: filter\n      };\n    }\n  });\n  return result;\n}\n\nvar defaultOpts = {\n  useCache: true,\n  skip: false,\n  throwErrors: false\n};\n\nfunction useQuery(query, opts) {\n  if (opts === void 0) {\n    opts = {};\n  }\n\n  var allOpts = _objectSpread2(_objectSpread2({}, defaultOpts), opts);\n\n  var contextClient = React.useContext(ClientContext);\n  var client = opts.client || contextClient;\n\n  var _React$useState = React.useState(false),\n      calledDuringSSR = _React$useState[0],\n      setCalledDuringSSR = _React$useState[1];\n\n  var _useClientRequest = useClientRequest(query, allOpts),\n      queryReq = _useClientRequest[0],\n      state = _useClientRequest[1];\n\n  if (client.ssrMode && opts.ssr !== false && !calledDuringSSR && !opts.skipCache && !opts.skip) {\n    // result may already be in the cache from previous SSR iterations\n    if (!state.data && !state.error) {\n      var p = queryReq();\n      client.ssrPromises.push(p);\n    }\n\n    setCalledDuringSSR(true);\n  }\n\n  var stringifiedAllOpts = JSON.stringify(allOpts);\n  React.useEffect(function () {\n    if (allOpts.skip) {\n      return;\n    }\n\n    queryReq();\n  }, [query, stringifiedAllOpts]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(function () {\n    if (state.error && allOpts.throwErrors) {\n      throw state.error;\n    }\n  }, [state.error, allOpts.throwErrors]);\n  var refetch = React.useCallback(function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return queryReq(_objectSpread2({\n      skipCache: true,\n      // don't call the updateData that has been passed into useQuery here\n      // reset to the default behaviour of returning the raw query result\n      // this can be overridden in refetch options\n      updateData: function updateData(_, data) {\n        return data;\n      }\n    }, options));\n  }, [queryReq]);\n  React.useEffect(function subscribeToMutationsAndRefetch() {\n    var mutationsMap = createRefetchMutationsMap(opts.refetchAfterMutations);\n    var mutations = Object.keys(mutationsMap);\n\n    var conditionalRefetch = function conditionalRefetch(_ref) {\n      var mutation = _ref.mutation,\n          variables = _ref.variables;\n      var filter = mutationsMap[mutation].filter;\n\n      if (!filter || variables && filter(variables)) {\n        refetch();\n      }\n    };\n\n    mutations.forEach(function (mutation) {\n      // this event is emitted from useClientRequest\n      client.mutationsEmitter.on(mutation, conditionalRefetch);\n    });\n    return function () {\n      mutations.forEach(function (mutation) {\n        client.mutationsEmitter.removeListener(mutation, conditionalRefetch);\n      });\n    };\n  }, [opts.refetchAfterMutations, refetch, client.mutationsEmitter]);\n  return _objectSpread2(_objectSpread2({}, state), {}, {\n    refetch: refetch\n  });\n}\n\nfunction useSubscription(options, callback) {\n  var callbackRef = useRef(callback);\n  callbackRef.current = callback;\n  var contextClient = useContext(ClientContext);\n  var client = options.client || contextClient;\n  var request = {\n    query: options.query,\n    variables: options.variables\n  };\n  useEffect(function () {\n    var observable = client.createSubscription(request);\n    var subscription = observable.subscribe({\n      next: function next(result) {\n        callbackRef.current(result);\n      },\n      error: function error(errors) {\n        callbackRef.current({\n          errors: errors\n        });\n      },\n      complete: function complete() {\n        subscription.unsubscribe();\n      }\n    });\n    return function () {\n      subscription.unsubscribe();\n    };\n  }, []); // eslint-disable-line\n  // the effect should be run when component is mounted and unmounted\n}\n\nvar useManualQuery = function useManualQuery(query, options) {\n  return useClientRequest(query, _objectSpread2({\n    useCache: true,\n    isManual: true\n  }, options));\n};\n\nvar useMutation = function useMutation(query, options) {\n  return useClientRequest(query, _objectSpread2({\n    isMutation: true\n  }, options));\n};\n\nexport { ClientContext, GraphQLClient, LocalGraphQLClient, LocalGraphQLError, useClientRequest, useManualQuery, useMutation, useQuery, useSubscription };\n"]},"metadata":{},"sourceType":"module"}